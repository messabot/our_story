<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Our Story ðŸ’—</title>

<style>
body {
  margin: 0;
  height: 100vh;
  background: #f8c8dc;
  display: flex;
  justify-content: center;
  align-items: center;
  font-family: Arial, sans-serif;
  text-align: center;
}

.screen {
  display: none;
  flex-direction: column;
  gap: 20px;
  max-width: 600px;
}

.active {
  display: flex;
}

button {
  padding: 12px 24px;
  border-radius: 30px;
  border: none;
  font-size: 1rem;
  cursor: pointer;
}

.answer {
  background: white;
  color: #b03060;
  font-weight: bold;
}

img {
  max-width: 250px;
  border-radius: 12px;
  margin: 0 auto;
}

.progress {
  font-size: 0.9rem;
  color: #6a1b4d;
}

.end-container {
  display: flex;
  gap: 20px;
}

.column {
  width: 200px;
  text-align: left;
  font-size: 0.9rem;
}

/* Voucher card styles */
.voucher-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 12px;
  max-height: 300px;
  overflow-y: auto;
  padding: 5px;
}

.voucher-card {
  background: #fff;
  border-radius: 12px;
  padding: 12px;
  flex: 1 1 140px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15);
  text-align: center;
  color: #b03060;
  font-weight: bold;
  cursor: default;
  transition: transform 0.2s;
  position: relative;
}

/* Tooltip for full reward text */
.voucher-card:hover::after {
  content: attr(data-full);
  position: absolute;
  bottom: 125%;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(255,255,255,0.95);
  color: #b03060;
  font-weight: normal;
  font-size: 0.8rem;
  padding: 6px;
  border-radius: 6px;
  white-space: pre-wrap;
  width: 180px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  z-index: 10;
}

.voucher-card:hover::before {
  content: "";
  position: absolute;
  bottom: 115%;
  left: 50%;
  transform: translateX(-50%);
  border-width: 5px;
  border-style: solid;
  border-color: rgba(255,255,255,0.95) transparent transparent transparent;
  z-index: 10;
}

.voucher-card:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

/* Voucher animation */
#voucher {
  display: none;
  padding: 40px;
  border-radius: 20px;
  color: white;
  font-size: 1.5rem;
  font-weight: bold;
  transform: scale(0);
  background: linear-gradient(135deg, #ff4da6, #ff66c4);
  position: relative;
  overflow: hidden;
  animation-fill-mode: forwards;
}

/* Sparkle animation */
.sparkle {
  position: absolute;
  width: 8px;
  height: 8px;
  background-color: white;
  border-radius: 50%;
  opacity: 0.8;
  animation: sparkle-fall 1s linear forwards;
}

@keyframes sparkle-fall {
  0% { transform: translate(0,0) scale(0); opacity: 1; }
  50% { transform: translate(var(--x), var(--y)) scale(1.5); opacity: 1; }
  100% { transform: translate(var(--x), var(--y)) scale(0); opacity: 0; }
}

/* Voucher pop animation */
@keyframes voucher-pop {
  0% { transform: scale(0); }
  60% { transform: scale(1.2); }
  80% { transform: scale(0.95); }
  100% { transform: scale(1); }
}

/* Confetti pieces */
.confetti-piece {
  position: absolute;
  width: 10px;
  height: 10px;
  background-color: white;
  opacity: 0.8;
  pointer-events: none;
  animation: confetti-fall 1.5s linear forwards;
}

@keyframes confetti-fall {
  0% { transform: translateY(0) rotate(0deg); }
  100% { transform: translateY(300px) rotate(360deg); opacity: 0; }
}
</style>
</head>

<body>

<!-- EmailJS -->
<script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
<script type="text/javascript">
   (function(){
      emailjs.init("lfBihHcp3KqNzmjnL"); // your public key
   })();
</script>

<!-- INTRO SCREEN -->
<div id="intro" class="screen active">
  <h1>ðŸ’— Valen-time To Remember ðŸ’—</h1>
  <p>
    Time for a trip down memory lane!<br><br>
    Answer these questions to receive your first set of Valentineâ€™s gifts,
    and to be reminded just how amazing we are!
  </p>
  <button type="button" id="startButton">Click me</button>
</div>

<!-- GAME SCREEN -->
<div id="game" class="screen">
  <div class="progress" id="progress"></div>
  <h2 id="question"></h2>
  <img id="questionImage" src="" alt="" style="display:none;">
  <div id="answers"></div>
</div>

<!-- FEEDBACK SCREEN -->
<div id="feedback" class="screen">
  <div id="voucher">
    <p id="voucherText"></p>
  </div>
  <img id="feedbackImage" src="" alt="" style="display:none;">
  <p id="feedbackText"></p>
  <button type="button" onclick="continueAfterFeedback()">Continue</button>
</div>

<!-- END SCREEN -->
<div id="end" class="screen">
  <h2>Congratulations Talya! ðŸ’—</h2>

  <div class="end-container">
    <div class="column">
      <h3>Vouchers Won</h3>
      <div id="won" class="voucher-grid"></div>
    </div>

    <div>
      <p>
        You've finished the journey through (some of) our relationship!  
        I have no idea what score you've gotten, but knowing your memory
        Iâ€™ll bet itâ€™s not very highâ€¦<br><br>
        But what matters is that we have these memories together,
        and I canâ€™t wait to keep making more.<br><br>
        See you on Valentineâ€™s Day ðŸ’—<br><br>
        And remember to make note of which vouchers you've won! no cheating...
      </p>
    </div>

    <div class="column">
      <h3>Vouchers Missed</h3>
      <div id="missed" class="voucher-grid"></div>
    </div>
  </div>
</div>

<script>
const questions = [
  {
    q: "One of the first times we hung out was when we went to the funfair at Palmer Park! But do you remember why we ended up leaving later than planned?",
    answers: [
      "Josh lost his phone",
      "Sean dropped his glasses",
      "Henry and Mihai were making out in the bathroom"
    ],
    correct: ["Josh lost his phone"],
    reward: "\"erm..byeâ€¦\" - redeem this and we'll drop everything, no matter where we are or who we're with, and go home immediately",
    image: "https://i.postimg.cc/1RwnvRNg/IMG_5341_Original.jpg",
    feedbackImage: "https://i.postimg.cc/bYkDmY2Z/IMG_5344_Original.jpg"  
  },
  {
    q: "On our first date, things didn't quite end up going to plan! We spent our time talking on a bench, and I explained why I liked you! But do you remember what we were originally meant to do?",
    answers: ["Go to the circus", "Watch fireworks", "Go to a concert"],
    correct: ["Go to the circus"],
    reward: "\"scrap the plan\" - redeem this and we'll cancel any plans we might have and do anything else of your choosing instead",
    image: "https://i.postimg.cc/m2ScGdjC/quiz.jpg",
    feedbackImage: "https://i.postimg.cc/QxDBwLQL/IMG_8200.jpg"
  },
  {
    q: "On bonfire night, after we set off the fireworks, everyone came back to my place, but you ended up staying really late for, uh, reasons... But do you remember how late it was when you left? ",
    answers: ["6:45am", "4am", "11pm"],
    correct: ["6:45am"],
    reward: "\"honk mimimi\" - redeem this and we switch off all of our alarms and have a lie in",
    image: "https://i.postimg.cc/1XG8XMQZ/20C69481_385C_45B6_9F61_0C8E34E67F04_Original.jpg",
    feedbackImage: "https://i.postimg.cc/Yq74Zc6h/IMG_8708.jpg"
  },
  {
    q: "I came over to yours once for us to chill but ended up rushing out after an hour because Pierce asked me to come to his theatre performance. Do you remember why I got so mad though?",
    answers: [
      "He gave me the wrong time",
      "I didnâ€™t have a ticket",
      "I fell over on the way"
    ],
    correct: ["He gave me the wrong time"],
    reward: "\"my badâ€¦\" - redeem to inflict a punishment of choice on me - just nothing too crazy please!",
    image: "https://i.postimg.cc/Fsvf8ty4/IMG_8236_Original.jpg",
    feedbackImage: "https://i.postimg.cc/vHv1dPhM/IMG_8745.jpg"
  },
  {
    q: "The first time we had a sleepover was pretty early on! Do you remember what we were during the day before that though?",
    answers: [
      "Went to London to watch Look Back",
      "Went to Comic Con",
      "Went to Mojos"
    ],
    correct: ["Went to London to watch Look Back"],
    reward: "\"sleepover, now!\" - redeem for me to come and visit immediately, no questions asked",
    image: "https://i.postimg.cc/qMGtdmwN/IMG_9436.jpg",
    feedbackImage: "https://i.postimg.cc/h4Tz247Q/IMG_5850_Original.jpg"
  },
  {
    q: "We had our first double date with Mihai and Mollie in late November - what did we do?",
    answers: [
      "Saw the Christmas lights switch on",
      "Got coffee",
      "Watched a movie"
    ],
    correct: ["Saw the Christmas lights switch on"],
    reward: "\"lights up\" - redeem for one night of us staying up until the sun rises!",
    image: "https://i.postimg.cc/QN19fNWT/IMG_5867_Original.jpg",
    feedbackImage: "https://i.postimg.cc/KvbKwXn0/IMG_7998.jpg"
  },
  {
    q: "Our first big date in London was so much fun. We went ice skating and had an amazing dinner afterwards. Do you remember what we did before that though?",
    answers: [
      "Visited the Covent Garden Christmas tree & market",
      "Went shopping",
      "Overslept"
    ],
    correct: ["Visited the Covent Garden Christmas tree & market"],
    reward: "\"and action\" - redeem for a session of goofing off! we do something, or you ask me to do something, super funny or embarrassing and we do it!",
    image: "https://i.postimg.cc/qByh1BCn/IMG_6017_Original.jpg",
    feedbackImage: "https://i.postimg.cc/v8fg0867/IMG_6019_Original.jpg"  
  },
  {
    q: "An easy one for you! What day did we say we love each other for the first time?",
    answers: [
      "December 17th",
      "November 28th",
      "December 12th",
      "December 16th"
    ],
    correct: ["December 17th"],
    reward: "\"I love you, always\" - redeem for a moment of soppiness - a declaration of love, a love letter, a list of everything i love about you, anything you'd like",
    image: "https://i.postimg.cc/28xqfHGq/IMG_9459.jpg",
    retryExplanations: {
      "November 28th": "Thatâ€™s the day I knew I loved youâ€¦ and almost said it while drunk ðŸ’—",
      "December 12th": "Thatâ€™s the day I almost said it sober ðŸ˜…",
      "December 16th": "Thatâ€™s the day you almost said it ðŸ’ž"
    }
  },
  {
    q: "Last Valentine's was amazing. But the day didn't start very well! Do you remember why? ",
    answers: [
      "I was sneezing all morning",
      "I lost your gift",
      "We missed our train"
    ],
    correct: ["I was sneezing all morning"],
    reward: "\"it could always be worse\" - redeem for 30 minutes worth of tickling me unopposed... can be used all in one go, or spread across multiple days",
    image: "https://i.postimg.cc/RCK6gCn6/IMG_1560_Original.jpg",
    feedbackImage: "https://i.postimg.cc/HWXc6W74/IMG_6476_Original.jpg" 
  },
  {
    q: "I hate to bring it up but on my birthday last year I had to heroically save your life when you almost got hit by a car! But it was worth it, because I received a great gift from bossman in exchange! What was it?",
    answers: [
      "A jet lighter",
      "A pack of cigarettes",
      "A box of chocolates"
    ],
    correct: ["A jet lighter"],
    reward: "\"care package\" - redeem for one care package delivered to you asap! tell me what you'd like and i'll order it straight to you - food, drinks, snacks, whatever it may be!",
    image: "https://i.postimg.cc/h4Tz247s/IMG_6601_Original.jpg",
    feedbackImage: "https://i.postimg.cc/DfLJxfb5/IMG_6788_Original.jpg" 
  },
  {
    q: "We cooked dinner together quite a few times last year! But do you remember what the first thing we made together was?",
    answers: ["Salmon", "Chicken", "Mince beef"],
    correct: ["Salmon"],
    reward: "\"chefâ€™s choice\" - redeem for a dinner cooked by yours truly, anything you'd like - but you can help too if you'd like!",
    image: "https://i.postimg.cc/02C6qtnr/IMG_9150.jpg",
    feedbackImage: "https://i.postimg.cc/KcBk0cgs/IMG_7312_Original.jpg"
  },
  {
    q: "Do you remember where we went for dessert after you met my sister for the first time?",
    answers: ["Black Tap", "Amorino", "Creams"],
    correct: ["Black Tap"],
    reward: "\"bakerâ€™s choice\" - redeem for a dessert made by yours truly, anything you'd like - but you can help too if you'd like!",
    image: "https://i.postimg.cc/qMGtdmw6/IMG_9511.jpg",
    feedbackImage: "https://i.postimg.cc/kMK6TMtY/IMG_7617_Original.jpg"
  },
  {
    q: "We did a lot on our 6 month anniversary, including playing mini golf! Do you remember who won though?",
    answers: ["Both of us", "Me", "You"],
    correct: ["Both of us"],
    reward: "\"I win.\" - redeem during any kind of game, whether its just us, or if we're playing with others, for me to immediately start throwing and help you to win instead",
    image: "https://i.postimg.cc/fWmt8W0H/IMG_7225_Original.jpg",
    feedbackImage: "https://i.postimg.cc/qMrtSf8j/IMG_8039.jpg"
  },
  {
    q: "On your birthday, we had some incredible views. Which one was your favourite though?",
    answers: [
      "Breakfast view",
      "Rooftop cinema",
      "Royal Albert Hall"
    ],
    correct: [
      "Breakfast view",
      "Rooftop cinema",
      "Royal Albert Hall"
    ],
    reward: "\"the best view is you\" -  redeem for one long distance dinner! i'll order us both food, and we have a dinner date together on video call!",
    image: "https://i.postimg.cc/8kMJZkr9/IMG_7776_Original.jpg"
  },
  {
    q: "Our Brighton trip was super fun (other than the spilt food incident...)! We went to the museum there, and outside of it there was a statue of a character from Bridgerton! Do you remember who?",
    answers: ["George IV", "Queen Charlotte", "George III"],
    correct: ["George IV"],
    reward: "\"you should see me in a crown\" - redeem for 1 hour of being Queen! I'll be your servant and we treat each other as such",
    image: "https://i.postimg.cc/RVm3yr7h/IMG_8610.jpg",
    feedbackImage: "https://i.postimg.cc/qMrtSfsB/IMG_8601.jpg"
  },
  {
    q: "I'll be shocked if you get this one, but take a guess! The place we went together the most last year was, by far and away, Black Sheep . But how many times did we go?",
    answers: ["87", "102", "65"],
    correct: ["87"],
    reward: "\"breakfast time\" - redeem for one breakfast (or lunch!) in bed - no need to get up to eat when the food can come to you!",
    image: "https://i.postimg.cc/jqPwMqJB/IMG_7816_Original.jpg",
    feedbackImage: "https://i.postimg.cc/jqPwMqJ9/IMG_7760.jpg"
  },
  {
    q: "July 21st might seem like a very random date to you but is very distinct in my memories. What happened that night that made it so memorable?",
    answers: [
      "You asked me for an NSFW picture",
      "We had a fight",
      "I broke my glasses"
    ],
    correct: ["You asked me for an NSFW picture"],
    reward: "\"because we're both hot as fuck\" - redeem for one XXX act of your choice",
    image: "https://i.postimg.cc/J4QyWTx4/IMG_8822.png",
    feedbackImage: "https://i.postimg.cc/J0Ns0KL1/IMG_0086.jpg"
  },
  {
    q: "Our one year anniversary happened a couple months ago! What was the first song we sung on karaoke? ",
    answers: ["Espresso", "Shake It Off", "Enemy"],
    correct: ["Espresso"],
    reward: "\"throwback challenge\" - redeem to recreate anything we've done in the last year! a specific date, or meal, moment, that you wanna relive",
    image: "https://i.postimg.cc/vHy1kRW2/IMG_8075.jpg",
    feedbackImage: "https://i.postimg.cc/Yq74Zc1V/IMG_8100.jpg"
  },
  {
    q: "On November 24th, despite sleeping all day, we still ended up going to bed early! Why?",
    answers: [
      "We passed out during a back massage",
      "Watching Love Island",
      "Eating dinner"
    ],
    correct: ["We passed out during a back massage"],
    reward: "\"my back hurts\" - redeem for one massage of your choice",
    image: "https://i.postimg.cc/PrMLk6yJ/IMG_8825.png",
    feedbackImage: "https://i.postimg.cc/sDJBRnms/IMG_8785.jpg"
  },
  {
    q: "What are we?",
    answers: ["The best!", "The best!", "The best!"],
    correct: ["The best!"],
    reward: "\"best couple perks\" - redeem for anything you'd like, whenever you'd like, wherever you'd like, whatever you'd like, because you're the best, and you deserve it ðŸ’—",
    image: "https://i.postimg.cc/VLwSpyqm/IMG_8585.jpg",
    feedbackImage: ""
  }
];

let index = 0;
let won = [];
let missed = [];
let retrySameQuestion = false;

function shuffle(array) {
  return array.map(value => ({ value, sort: Math.random() }))
              .sort((a,b) => a.sort - b.sort)
              .map(({value}) => value);
}

function startGame() {
  document.getElementById("intro").classList.remove("active");
  document.getElementById("game").classList.add("active");
  loadQuestion();
}

function loadQuestion() {
  const q = questions[index];
  document.getElementById("progress").innerText = `Memory ${index + 1} of ${questions.length} ðŸ’—`;
  document.getElementById("question").innerText = q.q;

  const qImg = document.getElementById("questionImage");
  if(q.image){ qImg.src=q.image; qImg.style.display="block"; }
  else { qImg.style.display="none"; }

  const answersDiv = document.getElementById("answers");
  answersDiv.innerHTML="";
  shuffle(q.answers).forEach(a=>{
    const btn=document.createElement("button");
    btn.className="answer";
    btn.innerText=a;
    btn.onclick=()=>answer(a);
    answersDiv.appendChild(btn);
  });
}

function answer(choice) {
  const q = questions[index];
  if(q.retryExplanations && q.retryExplanations[choice]){
    retrySameQuestion=true;
    showFeedback(q.retryExplanations[choice], q.feedbackImage, false);
    return;
  }
if (q.correct.includes(choice)) {
    won.push(`${q.q} â†’ ${q.reward}`);
    retrySameQuestion = false;
    showFeedback(q.reward, null, true);
} else {
    missed.push(`${q.q} â†’ ${q.reward}`);
    retrySameQuestion = false;
    showFeedback("Wrong...", q.feedbackImage, false);
  }
}

function showFeedback(text, image=false, correct=false){
  document.getElementById("game").classList.remove("active");
  document.getElementById("feedback").classList.add("active");
  const img=document.getElementById("feedbackImage");
  const voucher=document.getElementById("voucher");
  const voucherText=document.getElementById("voucherText");
  const feedbackText=document.getElementById("feedbackText");

  if(correct){
    img.style.display="none";
    feedbackText.style.display="none";
    voucherText.innerText=text;
    voucher.style.display="block";
    voucher.style.animation="voucher-pop 0.6s ease forwards";

    for(let i=0;i<10;i++){
      const sparkle=document.createElement("div");
      sparkle.classList.add("sparkle");
      sparkle.style.left=Math.random()*100+"%";
      sparkle.style.top=Math.random()*100+"%";
      sparkle.style.setProperty('--x',(Math.random()*200-100)+"px");
      sparkle.style.setProperty('--y',(Math.random()*200-100)+"px");
      voucher.appendChild(sparkle);
      setTimeout(()=>sparkle.remove(),1000);
    }

    for(let i=0;i<20;i++){
      const confetti=document.createElement("div");
      confetti.classList.add("confetti-piece");
      confetti.style.left=Math.random()*window.innerWidth+"px";
      confetti.style.backgroundColor=`hsl(${Math.random()*360}, 70%, 70%)`;
      document.body.appendChild(confetti);
      setTimeout(()=>confetti.remove(),1500);
    }
  } else {
    if(image){ img.src=image; img.style.display="block"; } 
    else { img.style.display="none"; }
    voucher.style.display="none";
    feedbackText.style.display="block";
    feedbackText.innerText=text;
  }
}

function continueAfterFeedback(){
  document.getElementById("feedback").classList.remove("active");
  if(!retrySameQuestion) index++;
  if(index>=questions.length){
    document.getElementById("end").classList.add("active");
    // Vouchers won
    const wonDiv=document.getElementById("won");
    won.forEach(v=>{
      const card=document.createElement("div");
      card.className="voucher-card";
      const [title]=v.split("-").map(s=>s.trim());
      card.innerText=title;
      card.setAttribute("data-full",v);
      wonDiv.appendChild(card);
    });
    // Vouchers missed
    const missedDiv=document.getElementById("missed");
    missed.forEach(v=>{
      const card=document.createElement("div");
      card.className="voucher-card";
      const [title]=v.split("-").map(s=>s.trim());
      card.innerText=title;
      card.setAttribute("data-full",v);
      missedDiv.appendChild(card);
    });
    // Send email with results
    sendResults();
  } else {
    document.getElementById("game").classList.add("active");
    loadQuestion();
  }
}

// --- EMAILJS FUNCTION ---
function sendResults() {
  const subject = "Talya's Quiz Results ðŸ’Œ";
  
  // Format the questions she got right
  const rightAnswers = won.length
    ? won.map((v, i) => `${i + 1}. ${v}`).join("\n")
    : "None! ðŸ˜…";

  // Format the questions she missed
  const wrongAnswers = missed.length
    ? missed.map((v, i) => `${i + 1}. ${v}`).join("\n")
    : "None! ðŸŽ‰";

  const message = `
Talya finished the quiz!

âœ… Questions she got RIGHT (${won.length}):
${rightAnswers}

âŒ Questions she got WRONG (${missed.length}):
${wrongAnswers}
`;

  // Send email using EmailJS (make sure your template has quiz_subject & quiz_message)
  emailjs.send("service_u1rr6f4", "template_pjg3tc8", {
    quiz_subject: subject,
    quiz_message: message
  })
  .then(res => console.log("Email sent!", res.status, res.text))
  .catch(err => console.log("Failed to send email:", err));
}

document.addEventListener("DOMContentLoaded",()=>{
  document.getElementById("startButton").addEventListener("click",startGame);
});
</script>

</body>
</html>
